name: Update API References

on:
  push:
    branches:
      - weiweng/auto-gen-api-ref  # Temporary: for testing
  schedule:
    # Run daily at 2 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  update-api-refs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout website repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.24.9'
      
      - name: Install tools
        run: make install-tools
      
      - name: Update API references
        run: make update-api-refs
      
      - name: Check for changes
        id: git-check
        run: |
          git diff --exit-code content/en/docs/api-reference/ || echo "has_changes=true" >> $GITHUB_OUTPUT
      
      - name: Create Pull Request
        if: steps.git-check.outputs.has_changes == 'true'
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'docs: update API references from kubefleet main'
          committer: GitHub Actions Bot <actions@github.com>
          author: GitHub Actions Bot <actions@github.com>
          branch: automated-api-ref-update
          delete-branch: true
          title: 'Update API references from KubeFleet main'
          body: |
            ## Automated API Reference Update
            
            This PR updates the API reference documentation by regenerating it from the latest KubeFleet main branch.
            
            ### Changes
            - Regenerated API references from `kubefleet-dev/kubefleet` main branch
            - Updated documentation for cluster.kubernetes-fleet.io/v1 and v1beta1
            - Updated documentation for placement.kubernetes-fleet.io/v1 and v1beta1
            
            ### Review Notes
            Please review the changes to ensure:
            - [ ] All API changes are accurately reflected
            - [ ] Hugo front matter is correctly applied
            - [ ] No unexpected changes were introduced
            
            ---
            ðŸ¤– This PR was automatically created by the API reference update workflow.
          labels: |
            documentation
            automated
